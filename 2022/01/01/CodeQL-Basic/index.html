<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CodeQL基础语法示例 | Zzer0's Blog</title><meta name="author" content="Zzer0"><meta name="copyright" content="Zzer0"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言由于CodeQL的特殊语法，其查询语句多数通过各种api调用来实现，因此，常常出现一个问题，想写代码不知该如何下手，看别人代码看不懂，直接看源码也不适合新手 同时CodeQL的官方文档其实也并非足够友好 在这里可以找到c&#x2F;c++的api CodeQL api for c&#x2F;c++ 官方文档提供了查询功能，但是解释得有些潦草 因此就需要借助各种示例来堆经验，才能独立写出合适的查询语句 本章借助一些">
<meta property="og:type" content="article">
<meta property="og:title" content="CodeQL基础语法示例">
<meta property="og:url" content="http://example.com/2022/01/01/CodeQL-Basic/index.html">
<meta property="og:site_name" content="Zzer0&#39;s Blog">
<meta property="og:description" content="前言由于CodeQL的特殊语法，其查询语句多数通过各种api调用来实现，因此，常常出现一个问题，想写代码不知该如何下手，看别人代码看不懂，直接看源码也不适合新手 同时CodeQL的官方文档其实也并非足够友好 在这里可以找到c&#x2F;c++的api CodeQL api for c&#x2F;c++ 官方文档提供了查询功能，但是解释得有些潦草 因此就需要借助各种示例来堆经验，才能独立写出合适的查询语句 本章借助一些">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2022-01-01T09:23:13.000Z">
<meta property="article:modified_time" content="2022-01-01T09:43:15.000Z">
<meta property="article:author" content="Zzer0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/01/01/CodeQL-Basic/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CodeQL基础语法示例',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-01-01 09:43:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/dimo.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Zzer0's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">CodeQL基础语法示例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-01T09:23:13.000Z" title="发表于 2022-01-01 09:23:13">2022-01-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-01-01T09:43:15.000Z" title="更新于 2022-01-01 09:43:15">2022-01-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CodeQL/">CodeQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CodeQL基础语法示例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于CodeQL的特殊语法，其查询语句多数通过各种api调用来实现，因此，常常出现一个问题，想写代码不知该如何下手，看别人代码看不懂，直接看源码也不适合新手</p>
<p>同时CodeQL的官方文档其实也<strong>并非足够友好</strong></p>
<p>在这里可以找到c/c++的api</p>
<p><a target="_blank" rel="noopener" href="https://codeql.github.com/codeql-standard-libraries/cpp/">CodeQL api for c/c++</a></p>
<p>官方文档提供了查询功能，但是<strong>解释得有些潦草</strong></p>
<p>因此就<strong>需要借助各种示例来堆经验，才能独立写出合适的查询语句</strong></p>
<p>本章借助一些基本示例来学习：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/github/codeql/tree/ddd4ccbb4b39adf3c2427088f4876432202c4eaa/cpp/ql/examples/snippets">some examples</a></p>
<p>如果你也对这些示例感兴趣，可以本地编译一个玩玩，不过建议还是可以到lgtm上面玩，数据库多，用起来也方便</p>
<p><a target="_blank" rel="noopener" href="https://lgtm.com/">lgtm</a></p>
<h1 id="addressof-ql"><a href="#addressof-ql" class="headerlink" title="addressof.ql"></a>addressof.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @description Finds address-of expressions (`&amp;`) that take the address of a reference variable</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> AddressOfExpr addr, VariableAccess access <span class="operator">/</span><span class="operator">/</span>取地址符  变量</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  access <span class="operator">=</span> addr.getOperand() <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>找到使用取地址符&quot;&amp;&quot;的地方；getOperand，获取此一元操作得操作数赋值给access</span><br><span class="line">  access.getTarget().getType() instanceof ReferenceType <span class="operator">/</span><span class="operator">/</span>判断该操作数是否属于引用的类型</span><br><span class="line"><span class="keyword">select</span> addr</span><br></pre></td></tr></table></figure>

<p><strong>该查询的作用为找到引用，注意是引用，和取地址是有区别的</strong></p>
<p>查询结果示例：</p>
<p><img src="https://s2.loli.net/2022/01/01/SqbKEtyuxmVZkIL.png" alt="image.png"></p>
<h1 id="arrayaccess-ql"><a href="#arrayaccess-ql" class="headerlink" title="arrayaccess.ql"></a>arrayaccess.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds array access expressions with an index expression consisting of a postfix increment (`++`) expression.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ArrayExpr a <span class="operator">/</span><span class="operator">/</span>ArrayExpr，数组访问表达式</span><br><span class="line"><span class="keyword">where</span> a.getArrayOffset() instanceof PostfixIncrExpr <span class="operator">/</span><span class="operator">/</span>getArrayOffset为获取给出<span class="operator">*</span><span class="operator">*</span>数组索引的表达式；<span class="operator">*</span><span class="operator">*</span>PostfixIncrExpr，后缀增量表达式<span class="operator">+</span><span class="operator">+</span></span><br><span class="line"><span class="keyword">select</span> a</span><br></pre></td></tr></table></figure>

<p><strong>查找具有由后缀增量 (<code>++</code>) 表达式组成的索引表达式的数组访问表达式，即查找对某数组元素进行++操作的地方</strong></p>
<p>示例：</p>
<p><img src="https://s2.loli.net/2022/01/01/yIcQtJ8zfHmwGTC.png" alt="image _1_.png"></p>
<h1 id="castexpr-ql"><a href="#castexpr-ql" class="headerlink" title="castexpr.ql"></a>castexpr.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds casts from a floating point type to an integer type</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Cast c <span class="operator">/</span><span class="operator">/</span>强制转换表达式</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  c.getExpr().getType() instanceof FloatingPointType <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>getExpr为获取<span class="operator">*</span><span class="operator">*</span>被<span class="operator">*</span><span class="operator">*</span>转换的表达式；被转换的表达式属于浮点类型</span><br><span class="line">  c.getType() instanceof IntegralType <span class="operator">/</span><span class="operator">/</span>getType为获取表达式<span class="operator">*</span><span class="operator">*</span>被转换成<span class="operator">*</span><span class="operator">*</span>的类型；被转换成的类型为整形</span><br><span class="line"><span class="keyword">select</span> c</span><br></pre></td></tr></table></figure>

<p><strong>查找从浮点类型到整数类型的转换</strong></p>
<h1 id="catch-exception-ql"><a href="#catch-exception-ql" class="headerlink" title="catch_exception.ql"></a>catch_exception.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds places where we catch exceptions of type `parse_error`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> CatchBlock catch <span class="operator">/</span><span class="operator">/</span>CatchBlock，catch块，错误捕捉</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> `stripType` converts `const parse_error <span class="operator">&amp;</span>` <span class="keyword">to</span> `parse_error`.</span><br><span class="line"><span class="keyword">where</span> catch.getParameter().getType().stripType().hasName(&quot;parse_error&quot;)</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>getParameter，获取此“catch 块”引入的参数（如果有），即捕捉到的错误</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>捕捉到的错误里有&quot;parse_error&quot;的字符串</span><br><span class="line"><span class="keyword">select</span> catch</span><br></pre></td></tr></table></figure>

<p><strong>查找我们捕获类型为 <code>parse_error</code> 的异常的地方，parse_error：拼写错误</strong></p>
<h1 id="constructor-call-ql"><a href="#constructor-call-ql" class="headerlink" title="constructor_call.ql"></a>constructor_call.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds places where we call `new MyClass(...)`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> NewExpr <span class="keyword">new</span>, Constructor c <span class="operator">/</span><span class="operator">/</span>NewExpr，<span class="keyword">new</span>表达式，例如<span class="keyword">new</span>一个对象；Constryctor，c<span class="operator">+</span><span class="operator">+</span>构造函数</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  c <span class="operator">=</span> new.getInitializer().(ConstructorCall).getTarget() <span class="keyword">and</span></span><br><span class="line">  <span class="operator">/</span><span class="operator">/</span>getInitializer，对于 operator <span class="keyword">new</span>，这将获取初始化已分配对象的调用或表达式（如果有）</span><br><span class="line">  c.getName() <span class="operator">=</span> &quot;MyClass&quot;</span><br><span class="line">  <span class="operator">/</span><span class="operator">/</span>对象调用为&quot;myclass&quot;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">new</span></span><br></pre></td></tr></table></figure>

<p><strong>查找我们调用<code>new MyClass(...)</code>的地方</strong></p>
<h1 id="derives-from-class-ql"><a href="#derives-from-class-ql" class="headerlink" title="derives_from_class.ql"></a>derives_from_class.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds classes that derive from `std::exception`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Class type <span class="operator">/</span><span class="operator">/</span>类</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  type.getABaseClass<span class="operator">+</span>().hasName(&quot;exception&quot;) <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>getABaseClass<span class="operator">+</span>获取基类(<span class="operator">+</span>号表至少获取一次，此处可以递归获取)，基类为exception</span><br><span class="line">  type.getNamespace().getName() <span class="operator">=</span> &quot;std&quot; <span class="operator">/</span><span class="operator">/</span>命名空间为std</span><br><span class="line"><span class="keyword">select</span> type</span><br></pre></td></tr></table></figure>

<p><strong>查找从<code>std::exception</code>派生的类</strong></p>
<h1 id="emptyblock-ql"><a href="#emptyblock-ql" class="headerlink" title="emptyblock.ql"></a>emptyblock.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds empty block statements</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> BlockStmt blk <span class="operator">/</span><span class="operator">/</span>块语句</span><br><span class="line"><span class="keyword">where</span> blk.getNumStmt() <span class="operator">=</span> <span class="number">0</span> <span class="operator">/</span><span class="operator">/</span>getNumStmt，获取此块中主体语句的数量，为<span class="number">0</span>则表示该块为空块</span><br><span class="line"><span class="keyword">select</span> blk</span><br></pre></td></tr></table></figure>

<p><strong>查找空块语句</strong></p>
<h1 id="emptythen-ql"><a href="#emptythen-ql" class="headerlink" title="emptythen.ql"></a>emptythen.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds `if` statements where the `then` branch is an empty block statement</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> IfStmt i <span class="operator">/</span><span class="operator">/</span>if语句块</span><br><span class="line"><span class="keyword">where</span> i.getThen().(BlockStmt).getNumStmt() <span class="operator">=</span> <span class="number">0</span> <span class="operator">/</span><span class="operator">/</span>获取<span class="keyword">then</span>语句块，强转为BlockStmt类型，判断该块是否为空</span><br><span class="line"><span class="keyword">select</span> i</span><br></pre></td></tr></table></figure>

<p><strong>查找<code>if</code>语句，其中<code>then</code>分支是一个空块语句</strong></p>
<p>结果类似前一个，不再赘述</p>
<h1 id="eq-true-ql"><a href="#eq-true-ql" class="headerlink" title="eq_true.ql"></a>eq_true.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds tests like `==true`, `!=true`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> EqualityOperation eq, Expr trueExpr <span class="operator">/</span><span class="operator">/</span>EqualityOperation匹配相等运算，即“<span class="operator">=</span><span class="operator">=</span>”或“<span class="operator">!=</span>”</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  trueExpr <span class="operator">=</span> eq.getAnOperand() <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取操作数</span><br><span class="line">  trueExpr.getType() instanceof BoolType <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>操作数为bool类型</span><br><span class="line">  trueExpr.getValue().toInt() <span class="operator">=</span> <span class="number">1</span> <span class="operator">/</span><span class="operator">/</span>操作数的值为<span class="literal">true</span></span><br><span class="line"><span class="keyword">select</span> eq</span><br></pre></td></tr></table></figure>

<p><strong>查找类似<code>==true</code>、<code>!=true</code></strong></p>
<h1 id="field-access-ql"><a href="#field-access-ql" class="headerlink" title="field_access.ql"></a>field_access.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds reads of `aDate` (defined on class `Order`)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Field f, FieldAccess access <span class="operator">/</span><span class="operator">/</span>Field，C 结构成员或 C<span class="operator">+</span><span class="operator">+</span> 非静态成员变量；FieldAccess，C<span class="operator">/</span>C<span class="operator">+</span><span class="operator">+</span> 字段访问表达式</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  f.hasName(&quot;aDate&quot;) <span class="keyword">and</span></span><br><span class="line">  f.getDeclaringType().hasName(&quot;Order&quot;) <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取声明此成员的类</span><br><span class="line">  f <span class="operator">=</span> access.getTarget()</span><br><span class="line"><span class="keyword">select</span> access</span><br></pre></td></tr></table></figure>

<p><strong>查找对<code>aDate</code>的读取（在类<code>Order</code>上定义）</strong></p>
<h1 id="function-call-ql"><a href="#function-call-ql" class="headerlink" title="function_call.ql"></a>function_call.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds calls to `std::map&lt;...&gt;::find()`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> FunctionCall <span class="keyword">call</span>, <span class="keyword">Function</span> fcn <span class="operator">/</span><span class="operator">/</span>函数调用点；函数</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  call.getTarget() <span class="operator">=</span> fcn <span class="keyword">and</span></span><br><span class="line">  fcn.getDeclaringType().getSimpleName() <span class="operator">=</span> &quot;map&quot; <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>声明类为map</span><br><span class="line">  fcn.getDeclaringType().getNamespace().getName() <span class="operator">=</span> &quot;std&quot; <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>命名空间为std</span><br><span class="line">  fcn.hasName(&quot;find&quot;) <span class="operator">/</span><span class="operator">/</span>调用的是find函数</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">call</span></span><br></pre></td></tr></table></figure>

<p><strong>查找对<code>std::map&lt;...&gt;::find()</code>的调用</strong></p>
<h1 id="integer-literal-ql"><a href="#integer-literal-ql" class="headerlink" title="integer_literal.ql"></a>integer_literal.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds places where we use the integer literal `2`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Literal literal <span class="operator">/</span><span class="operator">/</span>Literal提供用于对源代码中的文字进行建模的类，例如 <span class="number">0</span>、<span class="string">&#x27;c&#x27;</span> 或“字符串”</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  literal.getType() instanceof IntType <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取类型为整形</span><br><span class="line">  literal.getValue().toInt() <span class="operator">=</span> <span class="number">2</span> <span class="operator">/</span><span class="operator">/</span>值为<span class="number">2</span></span><br><span class="line"><span class="keyword">select</span> literal</span><br></pre></td></tr></table></figure>

<p><strong>查找我们使用整数文字“2”的地方</strong></p>
<h1 id="mutualrecursion-ql"><a href="#mutualrecursion-ql" class="headerlink" title="mutualrecursion.ql"></a>mutualrecursion.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds pairs of functions that call each other</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> <span class="keyword">Function</span> m, <span class="keyword">Function</span> n <span class="operator">/</span><span class="operator">/</span>函数m和函数n</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  <span class="keyword">exists</span>(FunctionCall c <span class="operator">|</span> c.getEnclosingFunction() <span class="operator">=</span> m <span class="keyword">and</span> c.getTarget() <span class="operator">=</span> n) <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取函数调用，父函数为m，调用了n</span><br><span class="line">  <span class="keyword">exists</span>(FunctionCall c <span class="operator">|</span> c.getEnclosingFunction() <span class="operator">=</span> n <span class="keyword">and</span> c.getTarget() <span class="operator">=</span> m) <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取函数调用，父函数为n，调用了m</span><br><span class="line">  m <span class="operator">!=</span> n</span><br><span class="line"><span class="keyword">select</span> m, n</span><br></pre></td></tr></table></figure>

<p><strong>查找相互调用的函数对</strong></p>
<h1 id="override-method-ql"><a href="#override-method-ql" class="headerlink" title="override_method.ql"></a>override_method.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds methods that override `std::exception::what()`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MemberFunction override, MemberFunction base <span class="operator">/</span><span class="operator">/</span>成员函数</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  base.getName() <span class="operator">=</span> &quot;what&quot; <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>函数名为what的作为base函数</span><br><span class="line">  base.getDeclaringType().getName() <span class="operator">=</span> &quot;exception&quot; <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取声明类为exception</span><br><span class="line">  base.getDeclaringType().getNamespace().getName() <span class="operator">=</span> &quot;std&quot; <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>获取声明类的命名空间为std</span><br><span class="line">  override.overrides<span class="operator">+</span>(base) <span class="operator">/</span><span class="operator">/</span>获取重写函数(至少获取一次)</span><br><span class="line"><span class="keyword">select</span> override</span><br></pre></td></tr></table></figure>

<p><strong>查找覆盖<code>std::exception::what()</code>的方法</strong></p>
<h1 id="returnstatement-ql"><a href="#returnstatement-ql" class="headerlink" title="returnstatement.ql"></a>returnstatement.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds return statements that return `0`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ReturnStmt r <span class="operator">/</span><span class="operator">/</span><span class="keyword">return</span></span><br><span class="line"><span class="keyword">where</span> r.getExpr().(Literal).getValue().toInt() <span class="operator">=</span> <span class="number">0</span> <span class="operator">/</span><span class="operator">/</span>getExpr获取表达式(Literal类型)，获取值为<span class="number">0</span></span><br><span class="line"><span class="keyword">select</span> r</span><br></pre></td></tr></table></figure>

<p><strong>查找返回“0”的返回语句</strong></p>
<h1 id="singletonblock-ql"><a href="#singletonblock-ql" class="headerlink" title="singletonblock.ql"></a>singletonblock.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds block statements containing a single statement</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> BlockStmt b <span class="operator">/</span><span class="operator">/</span>块</span><br><span class="line"><span class="keyword">where</span> b.getNumStmt() <span class="operator">=</span> <span class="number">1</span> <span class="operator">/</span><span class="operator">/</span>块的语句只有<span class="number">1</span>句</span><br><span class="line"><span class="keyword">select</span> b</span><br></pre></td></tr></table></figure>

<p><strong>查找包含单个语句的块语句</strong></p>
<h1 id="switchcase-ql"><a href="#switchcase-ql" class="headerlink" title="switchcase.ql"></a>switchcase.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds switch statements with a missing enum constant case and no default case</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> EnumSwitch es, EnumConstant ec <span class="operator">/</span><span class="operator">/</span>switch；枚举</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  ec <span class="operator">=</span> es.getAMissingCase() <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>从枚举类型中获取一个常量，该常量在此“switch”语句中没有使用</span><br><span class="line">  <span class="keyword">not</span> es.hasDefaultCase() <span class="operator">/</span><span class="operator">/</span>如果此“switch”语句具有“<span class="keyword">default</span> <span class="keyword">case</span>”语句，则保持不变；表示switch没有<span class="keyword">default</span>语句</span><br><span class="line"><span class="keyword">select</span> es, ec</span><br></pre></td></tr></table></figure>

<p><strong>查找缺少枚举常量 case 且没有 default case 的 switch 语句</strong></p>
<p>总结就是存在另外的情况但未匹配，也未加default处理的switch语句</p>
<h1 id="ternaryconditional-ql"><a href="#ternaryconditional-ql" class="headerlink" title="ternaryconditional.ql"></a>ternaryconditional.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds conditional expressions of the form `... ? ... : ...` where the types of the resulting expressions differ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ConditionalExpr e <span class="operator">/</span><span class="operator">/</span>ConditionalExpr为C<span class="operator">/</span>C<span class="operator">+</span><span class="operator">+</span> 条件三元表达式</span><br><span class="line"><span class="keyword">where</span> e.getThen().getType() <span class="operator">!=</span> e.getElse().getType() <span class="operator">/</span><span class="operator">/</span>获取此条件表达式的&quot;then&quot;表达式和&quot;else&quot;表达式，两者类型不同</span><br><span class="line"><span class="keyword">select</span> e</span><br></pre></td></tr></table></figure>

<p><strong>查找形式为<code>... ？ ... : ...</code>的条件表达式其中结果表达式的类型不同</strong></p>
<h1 id="throw-exception-ql"><a href="#throw-exception-ql" class="headerlink" title="throw_exception.ql"></a>throw_exception.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds places where we throw `parse_error` or one of its sub-types</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ThrowExpr throw</span><br><span class="line"><span class="keyword">where</span> throw.getType().(Class).getABaseClass<span class="operator">*</span>().getName() <span class="operator">=</span> &quot;parse_error&quot;</span><br><span class="line"><span class="keyword">select</span> throw</span><br></pre></td></tr></table></figure>

<p><strong>查找我们抛出<code>parse_error</code>或其子类型之一的地方</strong>，很简单，不再赘述</p>
<h1 id="todocomment-ql"><a href="#todocomment-ql" class="headerlink" title="todocomment.ql"></a>todocomment.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds comments containing the word &quot;TODO&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Comment c <span class="operator">/</span><span class="operator">/</span>注释</span><br><span class="line"><span class="keyword">where</span> c.getContents().<span class="keyword">matches</span>(&quot;%TODO%&quot;) <span class="operator">/</span><span class="operator">/</span>内容包含&quot;TODO&quot;</span><br><span class="line"><span class="keyword">select</span> c</span><br></pre></td></tr></table></figure>

<p><strong>查找包含单词“TODO”的注释</strong></p>
<h1 id="toomanyparams-ql"><a href="#toomanyparams-ql" class="headerlink" title="toomanyparams.ql"></a>toomanyparams.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds functions or methods with more than 10 parameters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> <span class="keyword">Function</span> fcn</span><br><span class="line"><span class="keyword">where</span> fcn.getNumberOfParameters() <span class="operator">&gt;</span> <span class="number">10</span> <span class="operator">/</span><span class="operator">/</span>获取函数的参数个数</span><br><span class="line"><span class="keyword">select</span> fcn</span><br></pre></td></tr></table></figure>

<p><strong>查找参数超过 10 个的函数或方法</strong></p>
<h1 id="unusedlocalvar-ql"><a href="#unusedlocalvar-ql" class="headerlink" title="unusedlocalvar.ql"></a>unusedlocalvar.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds local variables that are not accessed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> LocalScopeVariable v <span class="operator">/</span><span class="operator">/</span>局部变量或函数参数</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  <span class="keyword">not</span> v instanceof <span class="keyword">Parameter</span> <span class="keyword">and</span></span><br><span class="line">  <span class="keyword">not</span> <span class="keyword">exists</span>(v.getAnAccess()) <span class="operator">/</span><span class="operator">/</span>变量v未被访问且不再catch throw中被使用</span><br><span class="line"><span class="keyword">select</span> v</span><br></pre></td></tr></table></figure>

<p><strong>查找未被访问的局部变量</strong></p>
<h1 id="unusedmethod-ql"><a href="#unusedmethod-ql" class="headerlink" title="unusedmethod.ql"></a>unusedmethod.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds private non-virtual methods that are not accessed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MemberFunction fcn <span class="operator">/</span><span class="operator">/</span>成员函数</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  fcn.isPrivate() <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>为私有函数</span><br><span class="line">  <span class="keyword">not</span> fcn.isVirtual() <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>不是虚拟方法</span><br><span class="line">  <span class="keyword">not</span> <span class="keyword">exists</span>(FunctionCall <span class="keyword">call</span> <span class="operator">|</span> fcn <span class="operator">=</span> call.getTarget()) <span class="operator">/</span><span class="operator">/</span>未被调用</span><br><span class="line"><span class="keyword">select</span> fcn.getDefinition() <span class="operator">/</span><span class="operator">/</span>获取函数定义</span><br></pre></td></tr></table></figure>

<p><strong>查找未访问的私有非虚拟方法</strong></p>
<h1 id="unusedparam-ql"><a href="#unusedparam-ql" class="headerlink" title="unusedparam.ql"></a>unusedparam.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds parameters that are not accessed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> <span class="keyword">Parameter</span> p <span class="operator">/</span><span class="operator">/</span>参数p</span><br><span class="line"><span class="keyword">where</span> p.isNamed() <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span>(p.getAnAccess())  <span class="operator">/</span><span class="operator">/</span>有名称但未使用</span><br><span class="line"><span class="keyword">select</span> p</span><br></pre></td></tr></table></figure>

<p><strong>查找未被使用的参数</strong></p>
<h1 id="voidreturntype-ql"><a href="#voidreturntype-ql" class="headerlink" title="voidreturntype.ql"></a>voidreturntype.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds const methods whose return type is `void`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MemberFunction m <span class="operator">/</span><span class="operator">/</span>成员函数</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  m.hasSpecifier(&quot;const&quot;) <span class="keyword">and</span> <span class="operator">/</span><span class="operator">/</span>hasSpecifier：如果此声明具有给定名称的说明符，则成立；查找const说明符</span><br><span class="line">  m.getType() instanceof VoidType <span class="operator">/</span><span class="operator">/</span>类型为void</span><br><span class="line"><span class="keyword">select</span> m</span><br></pre></td></tr></table></figure>

<p><strong>查找返回类型为<code>void</code>的 const 方法</strong></p>
<h1 id="volatilevariable-ql"><a href="#volatilevariable-ql" class="headerlink" title="volatilevariable.ql"></a>volatilevariable.ql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description Finds variables with a `volatile` modifier</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import cpp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Variable f <span class="operator">/</span><span class="operator">/</span>变量</span><br><span class="line"><span class="keyword">where</span> f.isVolatile() <span class="operator">/</span><span class="operator">/</span>是volatile</span><br><span class="line"><span class="keyword">select</span> f</span><br></pre></td></tr></table></figure>

<p><strong>查找带有<code>volatile</code>修饰符的变量</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Zzer0</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/01/01/CodeQL-Basic/">http://example.com/2022/01/01/CodeQL-Basic/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Zzer0's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/03/emux/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">基于EMUX(原ARMX)的固件仿真，来自Cyberweek 会议</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/01/CodeQL-for-c-c-11/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CodeQL for c/c++(十一)：散列约束和值编号</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/dimo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zzer0</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Zzero00"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">如有错误，请多指教</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#addressof-ql"><span class="toc-number">2.</span> <span class="toc-text">addressof.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#arrayaccess-ql"><span class="toc-number">3.</span> <span class="toc-text">arrayaccess.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#castexpr-ql"><span class="toc-number">4.</span> <span class="toc-text">castexpr.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#catch-exception-ql"><span class="toc-number">5.</span> <span class="toc-text">catch_exception.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#constructor-call-ql"><span class="toc-number">6.</span> <span class="toc-text">constructor_call.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#derives-from-class-ql"><span class="toc-number">7.</span> <span class="toc-text">derives_from_class.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#emptyblock-ql"><span class="toc-number">8.</span> <span class="toc-text">emptyblock.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#emptythen-ql"><span class="toc-number">9.</span> <span class="toc-text">emptythen.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#eq-true-ql"><span class="toc-number">10.</span> <span class="toc-text">eq_true.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#field-access-ql"><span class="toc-number">11.</span> <span class="toc-text">field_access.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#function-call-ql"><span class="toc-number">12.</span> <span class="toc-text">function_call.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#integer-literal-ql"><span class="toc-number">13.</span> <span class="toc-text">integer_literal.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mutualrecursion-ql"><span class="toc-number">14.</span> <span class="toc-text">mutualrecursion.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#override-method-ql"><span class="toc-number">15.</span> <span class="toc-text">override_method.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#returnstatement-ql"><span class="toc-number">16.</span> <span class="toc-text">returnstatement.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#singletonblock-ql"><span class="toc-number">17.</span> <span class="toc-text">singletonblock.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#switchcase-ql"><span class="toc-number">18.</span> <span class="toc-text">switchcase.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ternaryconditional-ql"><span class="toc-number">19.</span> <span class="toc-text">ternaryconditional.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#throw-exception-ql"><span class="toc-number">20.</span> <span class="toc-text">throw_exception.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#todocomment-ql"><span class="toc-number">21.</span> <span class="toc-text">todocomment.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#toomanyparams-ql"><span class="toc-number">22.</span> <span class="toc-text">toomanyparams.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unusedlocalvar-ql"><span class="toc-number">23.</span> <span class="toc-text">unusedlocalvar.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unusedmethod-ql"><span class="toc-number">24.</span> <span class="toc-text">unusedmethod.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unusedparam-ql"><span class="toc-number">25.</span> <span class="toc-text">unusedparam.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#voidreturntype-ql"><span class="toc-number">26.</span> <span class="toc-text">voidreturntype.ql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#volatilevariable-ql"><span class="toc-number">27.</span> <span class="toc-text">volatilevariable.ql</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/17/CS143-PA3/" title="CS143: PA3"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CS143: PA3"/></a><div class="content"><a class="title" href="/2022/04/17/CS143-PA3/" title="CS143: PA3">CS143: PA3</a><time datetime="2022-04-17T07:54:48.000Z" title="发表于 2022-04-17 07:54:48">2022-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/17/CS143-PA2/" title="CS143: PA2"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CS143: PA2"/></a><div class="content"><a class="title" href="/2022/04/17/CS143-PA2/" title="CS143: PA2">CS143: PA2</a><time datetime="2022-04-17T07:40:50.000Z" title="发表于 2022-04-17 07:40:50">2022-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/17/CS143-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/" title="CS143: 第二章-词法分析"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CS143: 第二章-词法分析"/></a><div class="content"><a class="title" href="/2022/04/17/CS143-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/" title="CS143: 第二章-词法分析">CS143: 第二章-词法分析</a><time datetime="2022-04-17T07:16:51.000Z" title="发表于 2022-04-17 07:16:51">2022-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/17/CS143-%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="CS143: 第一章"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CS143: 第一章"/></a><div class="content"><a class="title" href="/2022/04/17/CS143-%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="CS143: 第一章">CS143: 第一章</a><time datetime="2022-04-17T06:51:09.000Z" title="发表于 2022-04-17 06:51:09">2022-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/13/Linux-kernel-protect-2/" title="Linux内核：保护模式进阶"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux内核：保护模式进阶"/></a><div class="content"><a class="title" href="/2022/02/13/Linux-kernel-protect-2/" title="Linux内核：保护模式进阶">Linux内核：保护模式进阶</a><time datetime="2022-02-13T16:14:13.000Z" title="发表于 2022-02-13 16:14:13">2022-02-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Zzer0</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '300bca8588d1f9350614',
      clientSecret: '49daaf392942e2e8348490fe0fe2d54575c4161a',
      repo: 'Zzero00.github.io',
      owner: 'Zzero00',
      admin: ['Zzero00'],
      id: 'fe381eafc694cdbe7ce412df53b74ef6',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>